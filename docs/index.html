<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <script src="bundle.js"></script>
  <script>
    // var text = scigen(['Albert Einstein']).files['paper.tex']
  </script>
</head>

<body>
  <script src="promisejs/promise.js"></script>
  <script src="pdftex.js"></script>
  <div id="tabs">
    <div class="tab" id="tab_input">
      <button id="compile" autofocus>Compile this LaTeX code to a PDF</button>
    </div>

    <div class="tab" id="tab_output">
      <h3>Console Output</h3>

      <pre id="output" style="overflow: scroll; max-height: 300px">
        Click "Compile this LaTeX code to PDF" at the top of this page and watch the console output here.
        </pre>

      <a name="running" id="running" style="display: none">
        Compiling…
        <img src="loading.gif" />
      </a>
    </div>

    <div class="tab" id="tab_open_pdf" style="display: none">
      <h3>View your PDF</h3>

      <button id="open_pdf_btn">Open your PDF</button>
      <p>
        Your LaTeX code is now compiled to a PDF document. The document is converted to a <a
          href="https://developer.mozilla.org/en-US/docs/data_URIs">data URI</a> that makes it possible to interpret the
        format correctly.
      </p>
      <a name="open_pdf"></a>
    </div>

  </div>

  <script>
    var visibilityChanger = function (element_id) {
      return function (visible) {
        document.getElementById(element_id).style.display = visible ? 'block' : 'none';
      }
    }

    var showLoadingIndicator = visibilityChanger("running")
    var showOpenButton = visibilityChanger("tab_open_pdf")

    var appendOutput = function (msg) {
      var content = document.getElementById("output").textContent;

      var output = document.getElementById("output");
      output.textContent = content + "\r\n" + msg;

      output.scrollTop = 999999;
      console.log(msg);
    }

    var pdf_dataurl = undefined;
    var compile = function (source_code) {
      document.getElementById("output").textContent = "";
      showLoadingIndicator(true);
      window.location.href = "#running";

      var pdftex = new PDFTeX();
      pdftex.set_TOTAL_MEMORY(80 * 1024 * 1024).then(function () {
        pdftex.FS_createLazyFile('/', 'snowden.jpg', 'snowden.jpg', true, true);
        pdftex.FS_createLazyFile('/', 'IEEEtran.cls', 'IEEEtran.cls', true, true)
        pdftex.FS_createLazyFile('/', 'IEEE.bst', 'IEEE.bst', true, true)

        pdftex.on_stdout = appendOutput;
        pdftex.on_stderr = appendOutput;

        var start_time = new Date().getTime();

        pdftex.compile(source_code).then(function (pdf_dataurl) {
          var end_time = new Date().getTime();
          console.info("Execution time: " + (end_time - start_time) / 1000 + ' sec');

          showLoadingIndicator(false);

          if (pdf_dataurl === false)
            return;
          showOpenButton(true);
          window.location.href = "#open_pdf";
          document.getElementById("open_pdf_btn").focus();
        });
      });
    }

    document.getElementById("compile").addEventListener("click", function (e) {
      var source_code = scigen(['Albert Einstein']).files['paper.tex']
      source_code =
        `\\documentclass[12pt]{article}
\\usepackage{amsmath}
\\usepackage{graphicx}

\\title{\\TeX live.js}
\\author{Created by Manuel Sch\\"olling}
\\date{\\today}
\\begin{document}
  \\maketitle
  \\TeX{}live.js is a compiler for the \\TeX{}
  typesetting program created using Mozilla's Emscripten
  Compiler. It offers programmable desktop
  publishing features and extensive facilities for
  automating most aspects of typesetting and desktop
  publishing, including numbering and cross-referencing,
  tables and figures, page layout, bibliographies, and
  much more. It supports \\LaTeX{} which was originally written 
  in 1984 by Leslie Lamport and has become the dominant method for
  using \\TeX;
 
  % This is a comment, not shown in final output.
  % The following shows typesetting power of LaTeX:
  \\begin{align}
    E_0 &= mc^2                              \\\\
    E &= \\frac{mc^2}{\\sqrt{1-\\frac{v^2}{c^2}}}
  \\end{align}


  \\TeX{}live.js even supports images! This photo was taken by Laura Poitras/Praxis Films

  \\includegraphics[height=5cm, keepaspectratio]{snowden}
\\end{document}`
      source_code = `
%\\documentclass[conference]{IEEEtran}
\\documentclass[12pt]{article}


\\usepackage{epsfig}
\\usepackage[latin1]{inputenc}
\\begin{document}

\\title{DewTab: Deployment of E-Commerce}
\\author{Albert Einstein and Jürgen Habermas}

\\date{}

\\maketitle




\\section*{Abstract}

Many cyberinformaticians would agree that, had it not been for voice-over-IP, the study of virtual machines might never have occurred. in fact, few steganographers would disagree with the exploration of link-level acknowledgements. we construct application for context-free grammar, which we call DewTab.




\\section{Introduction}

Many futurists would agree that, had it not been for architecture, the investigation of fiber-optic cables might never have occurred. given the current status of large-scale models, futurists shockingly desire the significant unification of cache coherence and RPCs, which embodies the compelling principles of machine learning. despite the fact that such a hypothesis at first glance seems counterintuitive, it fell in line with our expectations. unfortunately, a structured challenge in algorithms is the visualization of write-back caches. thusly, semaphores and robust archetypes offer a viable alternative to the emulation of congestion control.

\\end{document}`
      compile(source_code);
    });

    document.getElementById("open_pdf_btn").addEventListener("click", function (e) {
      window.open(pdf_dataurl);
      e.preventDefault();
    });

    var pdftex_preload = new PDFTeX("pdftex-worker.js");
    pdftex_preload = undefined;
  </script>
</body>

</html>